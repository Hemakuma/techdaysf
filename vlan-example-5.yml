---
-   name: Deploy Single vlan
    hosts: leafs
    connection: local
    gather_facts: no


    tasks:
        - name: Obtaining device credentials
          include_vars: credentials.yml

        #get the vlans from a separate file. Removing the need to hardcode vlan information inside your playbook
        - name: obtaining  vlan list
          include_vars: vlan_list.yml

        - name: obtaining server port list
          include_vars: port_list.yml

        - name: configuring vlans using vlan_list.yml
          nxos_vlan: vlan_id="{{ item.id }}"  name="{{ item.name }}" state="{{ item.state }}"  provider="{{ creds }}"
          with_items: "{{ vlan_list }}"

        - name: configuring description on switch ports based on the information in port_list.yml file
          nxos_interface: interface="{{ item.port }}" description="{{ item.description }}" provider="{{ creds }}"
          with_items: "{{ port_list }}"


        - name: configuring Uplink port on the switch based on the information in hosts variable
          nxos_switchport:
              interface: "{{ item.port }}"
              mode: trunk
              native_vlan: 999
              trunk_allowed_vlans: "{{ item.allowed_vlan }}"
              provider: "{{ creds }}"
          with_items: "{{ uplink_port }}"


        - name: Saving Configuration
          nxos_config:
              save: yes
              provider: "{{ creds }}"
