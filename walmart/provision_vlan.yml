---
# use the ansible modules
# provisioning vlan requires you to create BD, and create anp and EPG
# list all your vlans in the apic1.yml host vars
# using ansible aci ansible modules


-   name: Configuring PCI VLAN
    hosts: apic
    connection: local
    gather_facts: no
    
    tasks:
        - name: Creating PCI BD
          aci_bridge_domain:
              name: bd_{{ item.id }}
              context: "{{ item.vrf }}"
              tenant: 'walmart'
              state: "{{ item.state }}"
              subnet: "{{ item.subnet }}"
              username: "{{ user }}"
              password: "{{ passwd }}"
              host: "{{ inventory_hostname }}"
          with_items:
              - "{{ pci_vlans }}"
              - "{{ vlans }}"

        - name: Creating  PCI ANP
          aci_anp:
              name: qa_anp_pci_1
              tenant: 'walmart'
              state: present
              username: "{{ user }}"
              password: "{{ passwd }}"
              host: "{{ inventory_hostname }}"

        - name: Creating  non PCI ANP
          aci_anp:
              name: qa_anp_non_pci_1
              tenant: 'walmart'
              state: present
              username: "{{ user }}"
              password: "{{ passwd }}"
              host: "{{ inventory_hostname }}"

        - name: Create PCI EPG
          aci_epg:
            name: epg_{{ item.id }}
            bridge_domain: bd_{{ item.id }}
            anp: qa_anp_pci_1
            tenant: walmart
            state: "{{ item.state }}"
            username: "{{ user }}"
            password: "{{ passwd }}"
            host: "{{ inventory_hostname }}"
          with_items: "{{ pci_vlans }}"

        - name: Creating non PCI EPG
          aci_epg:
            name: epg_{{ item.id }}
            bridge_domain: bd_{{ item.id }}
            anp: qa_anp_non_pci_1
            tenant: walmart
            state: "{{ item.state }}"
            username: "{{ user }}"
            password: "{{ passwd }}"
            host: "{{ inventory_hostname }}"
          with_items: "{{ vlans }}"
