---
-   name: Creating templates for servers provisioning
    hosts: fw
    connection: local
    gather_facts: no

    tasks:
    # Create configuration files for server provisioning
        - name: creating the interface selector
          template: src=template/port_selector.j2 dest=configs/{{ inventory_hostname }}.xml

    #adding vlans to the trunk list
        - name: adding vlans to the trunk port on fw
          template: src=template/trunk_vlan.j2 dest=configs/fw_trunk.xml


-   name: Configuring ACI
    hosts: apic
    connection: local
    gather_facts: no

    tasks:
        - name: Assign the port to the switch
          aci_rest:
              action: post
              uri: /api/mo/uni.xml
              config_file: "{{ item }}"
              username: "{{ user }}"
              password: "{{ passwd }}"
              host: "{{ inventory_hostname }}"
          with_fileglob:
            - "configs/fw*"
